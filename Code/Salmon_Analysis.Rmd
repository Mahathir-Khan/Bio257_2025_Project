---
title: "Salmon_Analysis_Group4_ADxTummy"
output: html_document
date: "2025-11-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
install.packages("tximport")
install.packages("ensembldb")
install.packages("AnnotationsHub")
library(tximport)
library(ensembldb)
library(AnnotationHub)
library(DESeq2)
```

```{r}
hub = AnnotationHub()
```

```{r}
#make sure to use the right species
ensdb_query <- query(hub, c("EnsDb", "sapiens", "109"))
ensdb_query
```

```{r}
ensdb_109 <- ensdb_query[['AH109606']]
```

```{r}
# Extract transcript and gene information
tx_data <- transcripts(ensdb_109, return.type = "DataFrame")

# Create the tx2gene data.frame
tx2gene <- tx_data[, c("tx_id", "gene_id")]

tx2gene
```




```{r}
quants_dir <- "salmon_out/"

quant_files <- list.files(quants_dir, pattern = "quant.sf$", recursive = TRUE, full.names = TRUE)

quant_dirs <- list.files(quants_dir, pattern = "_quant$", full.names = TRUE)
sample_names <- gsub("_quant$", "", basename(quant_dirs))

names(quant_files) <- sample_names

quant_files
```


```{r}
txi <- tximport(quant_files, type = "salmon", tx2gene = tx2gene,ignoreTxVersion = TRUE)
```


```{r}
sample_names
```



```{r}
condition <- factor(c("KO","KO","KO","KO", "WT","WT","WT","WT"))
coldata <- data.frame(row.names = sample_names, condition)
coldata
```


```{r}
dds <- DESeqDataSetFromTximport(txi, coldata, ~condition)
dds
```

```{r}
dds <- DESeq(dds)
```

```{r}
vsdata <- vst(dds, blind = FALSE)
plotPCA(vsdata, intgroup = "condition")
```


```{r}
res <- results(dds, contrast = c('condition', 'KO', 'WT'))
```


```{r}
res
```



```{r}
sigs <- na.omit(res)
sigs <- sigs[sigs$padj < 0.05 & sigs$baseMean > 10, ]

sigs
```



```{r}
write.csv(counts(dds), "counts.csv")
```
